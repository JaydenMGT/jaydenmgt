<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <title>Records</title>
    <style>
        body {
            text-align: center;
            align-content: center;
            margin: 0;
            position: relative;
            height: 100vh;
            top: 0 !important;
        }

        .content {
            display: inline-block;
            font-size: 20px;
        }

        .container {
            display: grid;
            grid-template-columns: auto auto;
        }

        .container>div {
            padding: 5px 20px;
        }
    </style>
</head>

<body class="notranslate">

    <div style="position: absolute; top: 30px; right: 30px;">
        <button id="previous"><</button>
        <input type="date" id="date">
        <button id="next">></button>
    </div>

    <div id="content" class="content">

        <div id="list" class="container"></div>

    </div>

</body>

<!-- Database -->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue, child, get, serverTimestamp, query, orderByChild } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyCeVvD76hirn9IGTKoE_bX_bQdIlLn52t4",
        authDomain: "attendance-be10e.firebaseapp.com",
        databaseURL: "https://attendance-be10e-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "attendance-be10e",
        storageBucket: "attendance-be10e.appspot.com",
        messagingSenderId: "909884134254",
        appId: "1:909884134254:web:29d4a1690adccde280277f",
        measurementId: "G-MGVV7NVKTL"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Default today search
    var today = new Date();
    today.setDate(today.getDate() + 1);
    document.getElementById("date").valueAsDate = today;
    genList();

    document.getElementById("date").addEventListener("change", () => {
        genList();
    });

    document.getElementById("previous").addEventListener("click", () => {
        var iptDate = document.getElementById("date").valueAsDate;
        document.getElementById("date").valueAsDate = new Date(iptDate.setDate(iptDate.getDate() - 1));
        genList();
    });

    document.getElementById("next").addEventListener("click", () => {
        var iptDate = document.getElementById("date").valueAsDate;
        document.getElementById("date").valueAsDate = new Date(iptDate.setDate(iptDate.getDate() + 1));
        genList();
    });

    //generate attendance record list
    function genList(year, month, day) {
        var inputDate = document.getElementById("date").value.split("-");
        const attRecord = query(ref(database, 'attendance/' + parseInt(inputDate[0]) + '/' + parseInt(inputDate[1]) + '/' + parseInt(inputDate[2])), orderByChild('timestamp'));
        onValue(attRecord, (snapshot) => {

            if (snapshot.val() == null) {
                document.getElementById("list").innerHTML = `
                    <div>没有数据</div>
                `;
            } else {

                document.getElementById("list").innerHTML = `
                    <div style="border-bottom: 1px solid black;">时间</div><div style="border-bottom: 1px solid black;">名字</div>
                `;

                snapshot.forEach((child) => {

                    const timeStamp = child.val().timestamp;
                    var time = new Date(timeStamp);
                    var date = time.getDate();
                    var hours = "0" + time.getHours();
                    var minutes = "0" + time.getMinutes();
                    var seconds = "0" + time.getSeconds();
                    var formattedTime = hours.substr(-2) + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);

                    document.getElementById("list").innerHTML += `
                        <div>${formattedTime}</div><div>${child.key}</div>
                    `;

                });
            };

        });
    };

</script>
<!-- Stop Here -->

<script>

    resizePage();
    window.addEventListener("resize", resizePage);
    function resizePage() {
        if (window.innerWidth > window.innerHeight) {
            document.getElementById("content").style.scale = window.innerHeight / 800;
            console.log("w > h");
        } else {
            document.getElementById("content").style.scale = window.innerWidth / 400;
            console.log("h > w");
        }
    };

</script>

</html>
